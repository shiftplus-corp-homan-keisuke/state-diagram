# 開発ガイド

State Flow Visualizerの開発者向けガイドです。

## 環境構築

### 必要なツール

- Node.js 20以上
- npm 10以上

### セットアップ

```bash
# リポジトリをクローン
git clone <repository-url>
cd diagram

# フロントエンドのセットアップ
cd front
npm install
npm run dev
```

---

## プロジェクト構成

```
front/
├── src/
│   ├── types/           # TypeScript型定義
│   │   └── diagram.ts   # ダイアグラム関連の型
│   │
│   ├── db/              # データベース層
│   │   └── database.ts  # IndexedDB (Dexie) ラッパー
│   │
│   ├── stores/          # Zustand ストア
│   │   ├── diagramStore.ts  # ダイアグラム編集状態
│   │   └── uiStore.ts       # UI状態（選択、モーダル等）
│   │
│   ├── pages/           # ページコンポーネント
│   │   ├── DiagramListPage.tsx   # 一覧ページ
│   │   └── DiagramEditorPage.tsx # 編集ページ
│   │
│   ├── components/
│   │   ├── layout/      # レイアウト
│   │   │   └── Sidebar.tsx
│   │   │
│   │   ├── diagram/     # シーケンス図
│   │   │   ├── SequenceDiagram.tsx
│   │   │   ├── nodes/   # React Flowノード
│   │   │   └── edges/   # React Flowエッジ
│   │   │
│   │   └── ui/          # shadcn/ui コンポーネント
│   │
│   └── router.tsx       # ルーティング設定
│
├── package.json
├── vite.config.ts
└── tsconfig.json
```

---

## 技術スタック詳細

### React Flow

シーケンス図の描画に使用。カスタムノード/エッジで拡張。

```tsx
// カスタムノードの例
const ActorNode = ({ data }) => (
  <div className="actor-node">
    <Handle type="target" position={Position.Top} />
    {data.label}
    <Handle type="source" position={Position.Bottom} />
  </div>
);
```

### Zustand

軽量な状態管理ライブラリ。

```tsx
// ストアの使用例
const { diagram, addActor } = useDiagramStore();
```

### Dexie.js

IndexedDBのラッパー。

```tsx
// データベース操作例
await saveDiagram(diagram);
const diagrams = await getAllDiagrams();
```

---

## コーディング規約

### ファイル命名

- コンポーネント: `PascalCase.tsx`
- ユーティリティ: `camelCase.ts`
- 型定義: `camelCase.ts`

### コンポーネント

- 関数コンポーネント + hooks を使用
- Props型は `interface XxxProps` で定義
- `memo()` は必要な場合のみ使用

### 状態管理

- グローバル状態: Zustand
- ローカル状態: useState / useReducer
- サーバー状態: TanStack Query（将来）

---

## 開発コマンド

```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# リント
npm run lint

# プレビュー
npm run preview
```

---

## 追加機能の実装方法

### 新しいノードタイプを追加

1. `components/diagram/nodes/` に新しいコンポーネントを作成
2. `SequenceDiagram.tsx` の `nodeTypes` に追加

### 新しいエッジタイプを追加

1. `components/diagram/edges/` に新しいコンポーネントを作成
2. `SequenceDiagram.tsx` の `edgeTypes` に追加

### shadcn/ui コンポーネントを追加

```bash
npx shadcn@latest add <component-name>
```
